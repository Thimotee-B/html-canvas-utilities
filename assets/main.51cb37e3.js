import{r as O,i as P,s as S,$ as x,n as E}from"./vendor.6869b30c.js";const b=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=e(t);fetch(t.href,r)}};b();function d(s,n){if(n.startsWith("--")){var e=getComputedStyle(s);return e.getPropertyValue(n)}return n}function C(s,n,e){var o=e.offset,t=e.scale,r=e.backgroundColor,a=e.gridColor;n.save();var i=20*t,h=Math.round(o.x)%i,l=Math.round(o.y)%i;n.fillStyle=d(s,r),n.fillRect(0,0,s.width,s.height),n.strokeStyle=d(s,a),n.lineWidth=.23*t;for(var c=h;c<s.width;c+=i)n.beginPath(),n.moveTo(c,0),n.lineTo(c,s.height),n.stroke();for(var u=l;u<s.height;u+=i)n.beginPath(),n.moveTo(0,u),n.lineTo(s.width,u),n.stroke();n.restore()}var T=function(){function s(){this.listeners=[]}return s.prototype.addListener=function(n){this.listeners.push(n)},s.prototype.removeListener=function(n){this.listeners=this.listeners.filter(function(e){return e!==n})},s.prototype.notifyListeners=function(){for(var n=0,e=this.listeners;n<e.length;n++){var o=e[n];o(this)}},s}(),k=globalThis&&globalThis.__extends||function(){var s=function(n,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o[r]=t[r])},s(n,e)};return function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(n,e);function o(){this.constructor=n}n.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),w={scale:1,offset:new DOMPoint(0,0)},_=function(s){k(n,s);function n(e,o){o===void 0&&(o=w);var t=s.call(this)||this;t.canvas=e,t.options=o,t.gestureEvent=!1,t.mouse=new DOMPoint(0,0),t.mouseDown=!1,t.spacePressed=!1,t.controlPressed=!1,t.shiftPressed=!1,t.middleClick=!1,t.shouldNotify=!0,t.minScale=.1,t.maxScale=10,t.ctx=t.canvas.getContext("2d"),t.transform=t.ctx.getTransform(),t.shouldNotify=!1;var r=o.scale,a=o.offset;return t.scale(r),t.pan(a),t.shouldNotify=!0,t.onWheelEvent=t.onWheelEvent.bind(t),e.addEventListener("wheel",t.onWheelEvent,{passive:!1}),t.onMouseDown=t.onMouseDown.bind(t),e.addEventListener("mousedown",t.onMouseDown,!1),t.onMouseMove=t.onMouseMove.bind(t),e.addEventListener("mousemove",t.onMouseMove,!1),t.onMouseUp=t.onMouseUp.bind(t),e.addEventListener("mouseup",t.onMouseUp,!1),t.onTouchStart=t.onTouchStart.bind(t),e.addEventListener("touchstart",t.onTouchStart,!1),t.onTouchMove=t.onTouchMove.bind(t),e.addEventListener("touchmove",t.onTouchMove,!1),t.onTouchEnd=t.onTouchEnd.bind(t),e.addEventListener("touchend",t.onTouchEnd,!1),t.onKeyDownEvent=t.onKeyDownEvent.bind(t),t.onKeyUpEvent=t.onKeyUpEvent.bind(t),document.addEventListener("keydown",t.onKeyDownEvent,!1),document.addEventListener("keyup",t.onKeyUpEvent,!1),t}return Object.defineProperty(n.prototype,"matrix",{get:function(){return this.transform},set:function(e){this.transform=e,this.notify()},enumerable:!1,configurable:!0}),n.prototype.notify=function(){!this.shouldNotify||this.notifyListeners()},n.prototype.localPoint=function(e){var o=this.info,t=o.scale,r=o.offset,a=e.x/t-r.x/t,i=e.y/t-r.y/t;return new DOMPoint(a,i)},n.prototype.applyTransform=function(e){e.setTransform(this.matrix)},n.prototype.scale=function(e,o){if(o===void 0&&(o=new DOMPoint(0,0)),!Number.isNaN(e)){var t=e*this.info.scale;if(this.options.scale=t,!(t<this.minScale||t>this.maxScale)){var r=this.localPoint(o);this.matrix=this.matrix.scale(e,e,0,r.x,r.y,r.z),this.notify()}}},n.prototype.pan=function(e){if(!Number.isNaN(e)){var o=this.info.scale;this.options.offset.x+=e.x/o,this.options.offset.y+=e.y/o,this.matrix=this.matrix.translate(e.x/o,e.y/o,e.z/o),this.notify()}},Object.defineProperty(n.prototype,"info",{get:function(){var e=L(this.matrix),o=e.scaleX,t=e.scaleY,r=e.translateX,a=e.translateY,i=e.rotate;return{scale:Math.min(o,t),offset:new DOMPoint(r,a),rotation:i,mouse:this.mouse,mouseDown:this.mouseDown}},enumerable:!1,configurable:!0}),n.prototype.onWheelEvent=function(e){if(this.preventDefault(e),!this.gestureEvent){var o=new DOMPoint(e.offsetX,e.offsetY);if(e.ctrlKey||this.controlPressed){var t=1;e.deltaY<0?t=Math.min(this.maxScale,t*1.1):t=Math.max(this.minScale,t*(1/1.1)),this.scale(t,o)}else this.pan(new DOMPoint(-e.deltaX,-e.deltaY))}},n.prototype.onMouseDown=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!0},n.prototype.onMouseMove=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY)},n.prototype.onMouseUp=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!1},n.prototype.onTouchStart=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1},n.prototype.onTouchMove=function(e){this.preventDefault(e);var o=this.touches;if(this.touches=e.touches,this.gestureEvent){var t=new DOMPoint(o[0].clientX,o[0].clientY),r=new DOMPoint(o[1].clientX,o[1].clientY),a=new DOMPoint(this.touches[0].clientX,this.touches[0].clientY),i=new DOMPoint(this.touches[1].clientX,this.touches[1].clientY);if(this.touches.length===2){var h=new DOMPoint((t.x+r.x)/2,(t.y+r.y)/2),l=new DOMPoint((a.x+i.x)/2,(a.y+i.y)/2),c=t.x-r.x,u=a.x-i.x,g=u/c;if(this.scale(g,l),l!==h){var f=new DOMPoint(Math.min(t.x,r.x),Math.min(t.y,r.y)),v=new DOMPoint(Math.min(a.x,i.x),Math.min(a.y,i.y)),y=new DOMPoint(v.x-f.x,v.y-f.y);this.pan(y)}}else if(this.touches.length===3){var m=new DOMPoint(o[2].clientX,o[2].clientY),D=new DOMPoint(this.touches[2].clientX,this.touches[2].clientY),f=new DOMPoint(Math.min(t.x,r.x,m.x),Math.min(t.y,r.y,m.y)),v=new DOMPoint(Math.min(a.x,i.x,m.x),Math.min(a.y,i.y,D.y)),y=new DOMPoint(v.x-f.x,v.y-f.y);this.pan(y)}}},n.prototype.onTouchEnd=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1},n.prototype.onKeyDownEvent=function(e){this.preventDefault(e),e.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):e.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):e.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):e.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):e.key==="="?this.scale(1.1,this.mouse):e.key==="-"&&this.scale(1/1.1,this.mouse),this.controlPressed=e.ctrlKey,this.shiftPressed=e.shiftKey,this.spacePressed=e.key===" "},n.prototype.onKeyUpEvent=function(e){this.preventDefault(e),this.controlPressed=!1,this.spacePressed=!1,this.shiftPressed=!1},n.prototype.preventDefault=function(e){e.preventDefault()},n}(T);function L(s){var n=(s.a+s.d)/2,e=(s.a-s.d)/2,o=(s.c+s.b)/2,t=(s.c-s.b)/2,r=Math.sqrt(n*n+t*t),a=Math.sqrt(e*e+o*o),i=Math.atan2(o,e),h=Math.atan2(t,n),l=(h-i)/2,c=(h+i)/2;return{translateX:s.e,translateY:s.f,rotate:-c*180/Math.PI,scaleX:r+a,scaleY:r-a,skew:-l*180/Math.PI}}var Y=globalThis&&globalThis.__extends||function(){var s=function(n,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o[r]=t[r])},s(n,e)};return function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(n,e);function o(){this.constructor=n}n.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),X=function(s){Y(n,s);function n(e,o){o===void 0&&(o=w);var t=s.call(this,e,o)||this;return t.canvas=e,t.options=o,t.children=[],t.selection=[],t.hovered=[],t.canSelect=!0,t.canMove=!0,t.canDelete=!0,t}return n.prototype.drawBackground=function(){var e=this.info,o=e.offset,t=e.scale,r=this,a=r.ctx,i=r.canvas;if(this.options.drawBackground!==void 0){a.save(),this.options.drawBackground(a,o,t),a.restore();return}a.save(),a.fillStyle=d(i,"--canvas-controller-background-color"),a.fillRect(0,0,i.width,i.height),C(i,a,{offset:o,scale:t,backgroundColor:"--canvas-controller-background-color",gridColor:"--canvas-controller-grid-color"}),a.restore()},n.prototype.resize=function(){var e=this.canvas,o=getComputedStyle(e),t=this.canvas;t.width=parseInt(o.width,10),t.height=parseInt(o.height,10)},n.prototype.paint=function(){var e=this,o=this,t=o.canvas,r=o.ctx;this.resize(),r.clearRect(0,0,t.width,t.height),this.drawBackground(),this.applyTransform(r),this.drawContent(r),requestAnimationFrame(function(){return e.paint()})},n.prototype.drawContent=function(e){for(var o=0,t=this.children;o<t.length;o++){var r=t[o];e.save(),e.translate(r.rect.x,r.rect.y),r.draw(this.ctx,{width:r.rect.width,height:r.rect.height}),e.restore(),this.selection.includes(r)?this.drawOutline(e,r.rect,"--canvas-controller-selected-color"):this.hovered.includes(r)&&this.drawOutline(e,r.rect,"--canvas-controller-hovered-color")}},n.prototype.drawOutline=function(e,o,t){var r=this.canvas;if(this.options.drawOutline!==void 0){e.save(),this.options.drawOutline(e,o,t),e.restore();return}e.save(),e.strokeStyle=d(r,t),e.strokeRect(o.x,o.y,o.width,o.height),e.restore()},n.prototype.select=function(e,o){o===void 0&&(o=1);for(var t=this.localPoint(e),r=[],a=Array.from(this.children).reverse(),i=0,h=a;i<h.length;i++){var l=h[i],c=l.rect;if(t.x>=c.x&&t.x<=c.x+c.width&&t.y>=c.y&&t.y<=c.y+c.height){r.push(l);continue}}return r.slice(0,o)},n.prototype.onMouseDown=function(e){s.prototype.onMouseDown.call(this,e),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=e.button===1,this.updateCursor()},n.prototype.onMouseUp=function(e){s.prototype.onMouseUp.call(this,e),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=!1,this.updateCursor()},n.prototype.onMouseMove=function(e){var o=this.mouse;s.prototype.onMouseMove.call(this,e),this.hovered=this.select(this.mouse),this.mouseDown&&this.move(new DOMPoint(this.mouse.x-o.x,this.mouse.y-o.y)),this.updateCursor()},n.prototype.onTouchStart=function(e){if(s.prototype.onTouchStart.call(this,e),!this.gestureEvent&&this.canSelect){var o=e.touches[0],t=new DOMPoint(o.clientX,o.clientY);this.updateSelection(this.select(t))}},n.prototype.onTouchMove=function(e){var o=(this.touches||[])[0];if(s.prototype.onTouchMove.call(this,e),!this.gestureEvent){var t=e.touches[0];this.move(new DOMPoint(t.clientX-o.clientX,t.clientY-o.clientY))}},n.prototype.move=function(e){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(e.x,e.y));else if(this.canMove&&this.selection.length>0)for(var o=this.info.scale,t=0,r=this.selection;t<r.length;t++){var a=r[t],i=a.rect;i.x+=e.x/o,i.y+=e.y/o,a.rect=i,this.notify()}},n.prototype.onKeyDownEvent=function(e){s.prototype.onKeyDownEvent.call(this,e),e.key==="Backspace"&&this.removeSelection(),this.updateCursor()},n.prototype.onKeyUpEvent=function(e){s.prototype.onKeyUpEvent.call(this,e),this.updateCursor()},n.prototype.updateCursor=function(){var e=this,o=e.hovered,t=e.selection,r=e.spacePressed,a=e.canMove,i=t.length>0&&t.every(function(h){return o.includes(h)});r||this.middleClick?this.canvas.style.cursor="grab":t.length>0&&i&&a?this.canvas.style.cursor="move":this.canvas.style.cursor="default"},n.prototype.updateSelection=function(e){this.selection=e,this.notify()},n.prototype.clearSelection=function(){this.updateSelection([])},n.prototype.removeSelection=function(){var e=this;!this.canDelete||(this.children=this.children.filter(function(o){return!e.selection.includes(o)}),this.clearSelection())},n.prototype.addChild=function(e){this.children.push(e),this.updateSelection([e])},n}(_);function K(s){const n=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const e of n){const{x:o,y:t}={x:Math.random()*s.canvas.width,y:Math.random()*s.canvas.height},r=new DOMRect(o,t,100,100),a=`hsl(${Math.random()*360}, 100%, 50%)`;e==="rect"&&s.addChild({rect:r,draw:i=>{i.save(),i.fillStyle=a,i.fillRect(0,0,r.width,r.height),i.restore()}}),e==="circle"&&s.addChild({rect:r,draw:i=>{i.save(),i.beginPath(),i.arc(r.width/2,r.height/2,r.width/2,0,2*Math.PI),i.fillStyle=a,i.fill(),i.restore()}})}}var U=Object.defineProperty,N=Object.getOwnPropertyDescriptor,M=(s,n,e,o)=>{for(var t=o>1?void 0:o?N(n,e):n,r=s.length-1,a;r>=0;r--)(a=s[r])&&(t=(o?a(n,e,t):a(t))||t);return o&&t&&U(n,e,t),t};let p=class extends S{render(){return x` <canvas id="canvas"></canvas> `}firstUpdated(){const s=new X(this.canvas);s.addListener(()=>{const{offset:n,scale:e}=s.info;console.debug(`offset: ${n.x}, ${n.y}; scale: ${e}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,K(s),s.clearSelection(),s.paint()}};p.styles=O`
    canvas {
      --canvas-controller-background-color: #fafafa;
      --canvas-controller-grid-color: #ccc;
      --canvas-controller-selected-color: #f00;
      --canvas-controller-hovered-color: #0f0;
      cursor: pointer;
      user-select: none;
      user-zoom: none;
      /* min-height: 100vh; */
      /* max-height: 100vh; */
      /* min-width: 100vw; */
      /* max-width: 100vw; */
      /* min-height: -webkit-fill-available; */
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-controller-background-color: #333;
        --canvas-controller-grid-color: #666;
        --canvas-controller-selected-color: #bd0303;
        --canvas-controller-hovered-color: #04a104;
      }
    }
  `;M([P("#canvas")],p.prototype,"canvas",2);p=M([E("canvas-editor")],p);
