import{r as p,i as w,s as m,$ as y,n as M}from"./vendor.6869b30c.js";const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}};g();function a(i,t){return t.startsWith("--")?getComputedStyle(i).getPropertyValue(t):t}function D(i,t,e){const{offset:o,scale:s,backgroundColor:n,gridColor:h}=e;t.save();const r=20*s,l=Math.round(o.x)%r,d=Math.round(o.y)%r;t.fillStyle=a(i,n),t.fillRect(0,0,i.width,i.height),t.strokeStyle=a(i,h),t.lineWidth=.23*s;for(let c=l;c<i.width;c+=r)t.beginPath(),t.moveTo(c,0),t.lineTo(c,i.height),t.stroke();for(let c=d;c<i.height;c+=r)t.beginPath(),t.moveTo(0,c),t.lineTo(i.width,c),t.stroke();t.restore()}class P{constructor(){this.listeners=[]}addListener(t){this.listeners.push(t)}removeListener(t){this.listeners=this.listeners.filter(e=>e!==t)}notifyListeners(){for(const t of this.listeners)t(this)}}const f={scale:1,offset:new DOMPoint(0,0)};class E extends P{constructor(t,e=f){super();this.canvas=t,this.options=e,this.gestureEvent=!1,this.mouse=new DOMPoint(0,0),this.mouseDown=!1,this.shouldNotify=!0,this.minScale=.1,this.maxScale=10,this.ctx=this.canvas.getContext("2d"),this.transform=this.ctx.getTransform(),this.shouldNotify=!1;const{scale:o,offset:s}=e;this.scale(o),this.pan(s),this.shouldNotify=!0,this.onWheelEvent=this.onWheelEvent.bind(this),t.addEventListener("wheel",this.onWheelEvent,{passive:!1}),this.onMouseDown=this.onMouseDown.bind(this),t.addEventListener("mousedown",this.onMouseDown,!1),this.onMouseMove=this.onMouseMove.bind(this),t.addEventListener("mousemove",this.onMouseMove,!1),this.onMouseUp=this.onMouseUp.bind(this),t.addEventListener("mouseup",this.onMouseUp,!1),this.onTouchStart=this.onTouchStart.bind(this),t.addEventListener("touchstart",this.onTouchStart,!1),this.onTouchMove=this.onTouchMove.bind(this),t.addEventListener("touchmove",this.onTouchMove,!1),this.onTouchEnd=this.onTouchEnd.bind(this),t.addEventListener("touchend",this.onTouchEnd,!1),this.onKeyDownEvent=this.onKeyDownEvent.bind(this),this.onKeyUpEvent=this.onKeyUpEvent.bind(this),document.addEventListener("keydown",this.onKeyDownEvent,!1),document.addEventListener("keyup",this.onKeyUpEvent,!1)}get matrix(){return this.transform}set matrix(t){this.transform=t,this.notify()}notify(){!this.shouldNotify||this.notifyListeners()}localPoint(t){const{scale:e,offset:o}=this.info,s=t.x/e-o.x/e,n=t.y/e-o.y/e;return new DOMPoint(s,n)}applyTransform(t){t.setTransform(this.matrix)}scale(t,e=new DOMPoint(0,0)){if(Number.isNaN(t))return;console.debug("scale",t,e);const o=t*this.info.scale;if(this.options.scale=o,o<this.minScale||o>this.maxScale)return;const s=this.localPoint(e);this.matrix=this.matrix.scale(t,t,0,s.x,s.y,s.z),this.notify()}pan(t){if(Number.isNaN(t))return;const{scale:e}=this.info;console.debug("pan",t),this.options.offset.x+=t.x/e,this.options.offset.y+=t.y/e,this.matrix=this.matrix.translate(t.x/e,t.y/e,t.z/e),this.notify()}get info(){const{scaleX:t,scaleY:e,translateX:o,translateY:s,rotate:n}=O(this.matrix);return{scale:Math.min(t,e),offset:new DOMPoint(o,s),rotation:n,mouse:this.mouse,mouseDown:this.mouseDown}}onWheelEvent(t){if(t.preventDefault(),this.gestureEvent)return;const e=new DOMPoint(t.offsetX,t.offsetY);if(t.ctrlKey){let o=1;t.deltaY<0?o=Math.min(this.maxScale,o*1.1):o=Math.max(this.minScale,o*(1/1.1)),this.scale(o,e)}else this.pan(new DOMPoint(-t.deltaX,-t.deltaY))}onMouseDown(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY),this.mouseDown=!0}onMouseMove(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY)}onMouseUp(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY),this.mouseDown=!1}onTouchStart(t){this.preventDefault(t),this.touches=t.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1}onTouchMove(t){this.preventDefault(t);const e=this.touches;if(this.touches=t.touches,this.gestureEvent){if(this.touches.length===2){const o=new DOMPoint((e[0].clientX+e[1].clientX)/2,(e[0].clientY+e[1].clientY)/2),s=new DOMPoint((t.touches[0].clientX+t.touches[1].clientX)/2,(t.touches[0].clientY+t.touches[1].clientY)/2),n=e[0].clientX-e[1].clientX,r=(t.touches[0].clientX-t.touches[1].clientX)/n;if(this.scale(r,s),s!==o){const l=new DOMPoint(s.x-o.x,s.y-o.y);this.pan(l)}}else if(this.touches.length===3){const o=new DOMPoint(Math.min(e[0].clientX,e[1].clientX,e[2].clientX),Math.min(e[0].clientY,e[1].clientY,e[2].clientY)),s=new DOMPoint(Math.min(t.touches[0].clientX,t.touches[1].clientX,t.touches[2].clientX),Math.min(t.touches[0].clientY,t.touches[1].clientY,t.touches[2].clientY)),n=new DOMPoint(s.x-o.x,s.y-o.y);this.pan(n)}}}onTouchEnd(t){this.preventDefault(t),this.touches=t.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1}onKeyDownEvent(t){t.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):t.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):t.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):t.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):t.key==="="?this.scale(1.1,this.mouse):t.key==="-"&&this.scale(1/1.1,this.mouse)}onKeyUpEvent(t){}preventDefault(t){}}function O(i){const t=(i.a+i.d)/2,e=(i.a-i.d)/2,o=(i.c+i.b)/2,s=(i.c-i.b)/2,n=Math.sqrt(t*t+s*s),h=Math.sqrt(e*e+o*o),r=Math.atan2(o,e),l=Math.atan2(s,t),d=(l-r)/2,c=(l+r)/2;return{translateX:i.e,translateY:i.f,rotate:-c*180/Math.PI,scaleX:n+h,scaleY:n-h,skew:-d*180/Math.PI}}class S extends E{constructor(t,e=f){super(t,e);this.canvas=t,this.options=e,this.children=[],this.selection=[],this.hovered=[],this.canSelect=!0,this.canMove=!0,this.canDelete=!0,this.spacePressed=!1,this.middleClick=!1}drawBackground(){const{offset:t,scale:e}=this.info,{ctx:o,canvas:s}=this;o.fillStyle=a(s,"--canvas-controller-background-color"),o.fillRect(0,0,s.width,s.height),D(s,o,{offset:t,scale:e,backgroundColor:"--canvas-controller-background-color",gridColor:"--canvas-controller-grid-color"})}resize(){const t=this.canvas,e=getComputedStyle(t),{canvas:o}=this;o.width=parseInt(e.width,10),o.height=parseInt(e.height,10)}paint(){const{canvas:t,ctx:e}=this;this.resize(),e.clearRect(0,0,t.width,t.height),this.drawBackground(),this.applyTransform(e),this.drawContent(e),requestAnimationFrame(()=>this.paint())}drawContent(t){for(const e of this.children)t.save(),t.translate(e.rect.x,e.rect.y),e.draw(this.ctx),t.restore(),this.selection.includes(e)?this.drawOutline(t,e.rect,"--canvas-controller-selected-color"):this.hovered.includes(e)&&this.drawOutline(t,e.rect,"--canvas-controller-hovered-color")}drawOutline(t,e,o){const{canvas:s}=this;t.save(),t.strokeStyle=a(s,o),t.strokeRect(e.x,e.y,e.width,e.height),t.restore()}select(t,e=1){const o=this.localPoint(t),s=[],n=Array.from(this.children).reverse();for(const h of n){const r=h.rect;if(o.x>=r.x&&o.x<=r.x+r.width&&o.y>=r.y&&o.y<=r.y+r.height){s.push(h);continue}}return s.slice(0,e)}onMouseDown(t){super.onMouseDown(t),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=t.button===1,this.updateCursor()}onMouseUp(t){super.onMouseUp(t),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=!1,this.updateCursor()}onMouseMove(t){const e=this.mouse;super.onMouseMove(t),this.hovered=this.select(this.mouse),this.mouseDown&&this.move(new DOMPoint(this.mouse.x-e.x,this.mouse.y-e.y)),this.updateCursor()}onTouchStart(t){if(super.onTouchStart(t),!this.gestureEvent&&this.canSelect){const e=t.touches[0],o=new DOMPoint(e.clientX,e.clientY);this.updateSelection(this.select(o))}}onTouchMove(t){const e=(this.touches||[])[0];if(super.onTouchMove(t),!this.gestureEvent){const o=t.touches[0];this.move(new DOMPoint(o.clientX-e.clientX,o.clientY-e.clientY))}}move(t){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(t.x,t.y));else if(this.canMove&&this.selection.length>0){const e=this.info.scale;for(const o of this.selection){const s=o.rect;s.x+=t.x/e,s.y+=t.y/e,o.rect=s,this.notify()}}}onKeyDownEvent(t){super.onKeyDownEvent(t),t.key==="Backspace"&&this.removeSelection(),this.spacePressed=t.key===" ",this.updateCursor()}onKeyUpEvent(t){super.onKeyUpEvent(t),this.spacePressed=!1,this.updateCursor()}updateCursor(){const{hovered:t,selection:e,spacePressed:o,canMove:s}=this,n=e.length>0&&e.every(h=>t.includes(h));o||this.middleClick?this.canvas.style.cursor="grab":e.length>0&&n&&s?this.canvas.style.cursor="move":this.canvas.style.cursor="default"}updateSelection(t){this.selection=t,this.notify()}clearSelection(){this.updateSelection([])}removeSelection(){!this.canDelete||(this.children=this.children.filter(t=>!this.selection.includes(t)),this.clearSelection())}addChild(t){this.children.push(t),this.updateSelection([t])}}function b(i){const t=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const e of t){const{x:o,y:s}={x:Math.random()*i.canvas.width,y:Math.random()*i.canvas.height},n=new DOMRect(o,s,100,100),h=`hsl(${Math.random()*360}, 100%, 50%)`;e==="rect"&&i.addChild({rect:n,draw:r=>{r.save(),r.fillStyle=h,r.fillRect(0,0,n.width,n.height),r.restore()}}),e==="circle"&&i.addChild({rect:n,draw:r=>{r.save(),r.beginPath(),r.arc(n.width/2,n.height/2,n.width/2,0,2*Math.PI),r.fillStyle=h,r.fill(),r.restore()}})}}var C=Object.defineProperty,X=Object.getOwnPropertyDescriptor,v=(i,t,e,o)=>{for(var s=o>1?void 0:o?X(t,e):t,n=i.length-1,h;n>=0;n--)(h=i[n])&&(s=(o?h(t,e,s):h(s))||s);return o&&s&&C(t,e,s),s};let u=class extends m{render(){return y` <canvas id="canvas" touch-action="none"></canvas> `}firstUpdated(){const i=new S(this.canvas);i.addListener(()=>{const{offset:t,scale:e}=i.info;console.debug(`offset: ${t.x}, ${t.y}; scale: ${e}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,b(i),i.clearSelection(),i.paint()}};u.styles=p`
    canvas {
      --canvas-controller-background-color: #fafafa;
      --canvas-controller-grid-color: #ccc;
      --canvas-controller-selected-color: #f00;
      --canvas-controller-hovered-color: #0f0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-controller-background-color: #333;
        --canvas-controller-grid-color: #666;
        --canvas-controller-selected-color: #bd0303;
        --canvas-controller-hovered-color: #04a104;
      }
    }
  `;v([w("#canvas")],u.prototype,"canvas",2);u=v([M("canvas-editor")],u);
