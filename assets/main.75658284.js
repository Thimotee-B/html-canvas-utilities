import{r as M,i as g,s as D,$ as P,n as O}from"./vendor.6869b30c.js";const x=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};x();function u(i,t){return t.startsWith("--")?getComputedStyle(i).getPropertyValue(t):t}function E(i,t,e){const{offset:n,scale:s,backgroundColor:o,gridColor:h}=e;t.save();const r=20*s,l=Math.round(n.x)%r,a=Math.round(n.y)%r;t.fillStyle=u(i,o),t.fillRect(0,0,i.width,i.height),t.strokeStyle=u(i,h),t.lineWidth=.23*s;for(let c=l;c<i.width;c+=r)t.beginPath(),t.moveTo(c,0),t.lineTo(c,i.height),t.stroke();for(let c=a;c<i.height;c+=r)t.beginPath(),t.moveTo(0,c),t.lineTo(i.width,c),t.stroke();t.restore()}class S{constructor(){this.listeners=[]}addListener(t){this.listeners.push(t)}removeListener(t){this.listeners=this.listeners.filter(e=>e!==t)}notifyListeners(){for(const t of this.listeners)t(this)}}const p={scale:1,offset:new DOMPoint(0,0)};class b extends S{constructor(t,e=p){super();this.canvas=t,this.options=e,this.gestureEvent=!1,this.mouse=new DOMPoint(0,0),this.mouseDown=!1,this.shouldNotify=!0,this.minScale=.1,this.maxScale=10,this.ctx=this.canvas.getContext("2d"),this.transform=this.ctx.getTransform(),this.shouldNotify=!1;const{scale:n,offset:s}=e;this.scale(n),this.pan(s),this.shouldNotify=!0,this.onWheelEvent=this.onWheelEvent.bind(this),t.addEventListener("wheel",this.onWheelEvent,{passive:!1}),this.onMouseDown=this.onMouseDown.bind(this),t.addEventListener("mousedown",this.onMouseDown,!1),this.onMouseMove=this.onMouseMove.bind(this),t.addEventListener("mousemove",this.onMouseMove,!1),this.onMouseUp=this.onMouseUp.bind(this),t.addEventListener("mouseup",this.onMouseUp,!1),this.onTouchStart=this.onTouchStart.bind(this),t.addEventListener("touchstart",this.onTouchStart,!1),this.onTouchMove=this.onTouchMove.bind(this),t.addEventListener("touchmove",this.onTouchMove,!1),this.onTouchEnd=this.onTouchEnd.bind(this),t.addEventListener("touchend",this.onTouchEnd,!1),this.onKeyDownEvent=this.onKeyDownEvent.bind(this),this.onKeyUpEvent=this.onKeyUpEvent.bind(this),document.addEventListener("keydown",this.onKeyDownEvent,!1),document.addEventListener("keyup",this.onKeyUpEvent,!1)}get matrix(){return this.transform}set matrix(t){this.transform=t,this.notify()}notify(){!this.shouldNotify||this.notifyListeners()}localPoint(t){const{scale:e,offset:n}=this.info,s=t.x/e-n.x/e,o=t.y/e-n.y/e;return new DOMPoint(s,o)}applyTransform(t){t.setTransform(this.matrix)}scale(t,e=new DOMPoint(0,0)){if(Number.isNaN(t))return;console.debug("scale",t,e);const n=t*this.info.scale;if(this.options.scale=n,n<this.minScale||n>this.maxScale)return;const s=this.localPoint(e);this.matrix=this.matrix.scale(t,t,0,s.x,s.y,s.z),this.notify()}pan(t){if(Number.isNaN(t))return;const{scale:e}=this.info;console.debug("pan",t),this.options.offset.x+=t.x/e,this.options.offset.y+=t.y/e,this.matrix=this.matrix.translate(t.x/e,t.y/e,t.z/e),this.notify()}get info(){const{scaleX:t,scaleY:e,translateX:n,translateY:s,rotate:o}=C(this.matrix);return{scale:Math.min(t,e),offset:new DOMPoint(n,s),rotation:o,mouse:this.mouse,mouseDown:this.mouseDown}}onWheelEvent(t){if(this.preventDefault(t),this.gestureEvent)return;const e=new DOMPoint(t.offsetX,t.offsetY);if(t.ctrlKey){let n=1;t.deltaY<0?n=Math.min(this.maxScale,n*1.1):n=Math.max(this.minScale,n*(1/1.1)),this.scale(n,e)}else this.pan(new DOMPoint(-t.deltaX,-t.deltaY))}onMouseDown(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY),this.mouseDown=!0}onMouseMove(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY)}onMouseUp(t){this.mouse=new DOMPoint(t.offsetX,t.offsetY),this.mouseDown=!1}onTouchStart(t){this.preventDefault(t),this.touches=t.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1}onTouchMove(t){this.preventDefault(t);const e=this.touches;if(this.touches=t.touches,this.gestureEvent){const n=new DOMPoint(e[0].clientX,e[0].clientY),s=new DOMPoint(e[1].clientX,e[1].clientY),o=new DOMPoint(this.touches[0].clientX,this.touches[0].clientY),h=new DOMPoint(this.touches[1].clientX,this.touches[1].clientY);if(this.touches.length===2){const r=new DOMPoint((n.x+s.x)/2,(n.y+s.y)/2),l=new DOMPoint((o.x+h.x)/2,(o.y+h.y)/2),a=n.x-s.x,f=(o.x-h.x)/a;if(this.scale(f,l),l!==r){const v=new DOMPoint(Math.min(n.x,s.x),Math.min(n.y,s.y)),w=new DOMPoint(Math.min(o.x,h.x),Math.min(o.y,h.y)),m=new DOMPoint(w.x-v.x,w.y-v.y);this.pan(m)}}else if(this.touches.length===3){const r=new DOMPoint(e[2].clientX,e[2].clientY),l=new DOMPoint(this.touches[2].clientX,this.touches[2].clientY),a=new DOMPoint(Math.min(n.x,s.x,r.x),Math.min(n.y,s.y,r.y)),c=new DOMPoint(Math.min(o.x,h.x,r.x),Math.min(o.y,h.y,l.y)),f=new DOMPoint(c.x-a.x,c.y-a.y);this.pan(f)}}}onTouchEnd(t){this.preventDefault(t),this.touches=t.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1}onKeyDownEvent(t){t.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):t.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):t.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):t.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):t.key==="="?this.scale(1.1,this.mouse):t.key==="-"&&this.scale(1/1.1,this.mouse)}onKeyUpEvent(t){}preventDefault(t){t.preventDefault()}}function C(i){const t=(i.a+i.d)/2,e=(i.a-i.d)/2,n=(i.c+i.b)/2,s=(i.c-i.b)/2,o=Math.sqrt(t*t+s*s),h=Math.sqrt(e*e+n*n),r=Math.atan2(n,e),l=Math.atan2(s,t),a=(l-r)/2,c=(l+r)/2;return{translateX:i.e,translateY:i.f,rotate:-c*180/Math.PI,scaleX:o+h,scaleY:o-h,skew:-a*180/Math.PI}}class k extends b{constructor(t,e=p){super(t,e);this.canvas=t,this.options=e,this.children=[],this.selection=[],this.hovered=[],this.canSelect=!0,this.canMove=!0,this.canDelete=!0,this.spacePressed=!1,this.middleClick=!1}drawBackground(){const{offset:t,scale:e}=this.info,{ctx:n,canvas:s}=this;n.fillStyle=u(s,"--canvas-controller-background-color"),n.fillRect(0,0,s.width,s.height),E(s,n,{offset:t,scale:e,backgroundColor:"--canvas-controller-background-color",gridColor:"--canvas-controller-grid-color"})}resize(){const t=this.canvas,e=getComputedStyle(t),{canvas:n}=this;n.width=parseInt(e.width,10),n.height=parseInt(e.height,10)}paint(){const{canvas:t,ctx:e}=this;this.resize(),e.clearRect(0,0,t.width,t.height),this.drawBackground(),this.applyTransform(e),this.drawContent(e),requestAnimationFrame(()=>this.paint())}drawContent(t){for(const e of this.children)t.save(),t.translate(e.rect.x,e.rect.y),e.draw(this.ctx),t.restore(),this.selection.includes(e)?this.drawOutline(t,e.rect,"--canvas-controller-selected-color"):this.hovered.includes(e)&&this.drawOutline(t,e.rect,"--canvas-controller-hovered-color")}drawOutline(t,e,n){const{canvas:s}=this;t.save(),t.strokeStyle=u(s,n),t.strokeRect(e.x,e.y,e.width,e.height),t.restore()}select(t,e=1){const n=this.localPoint(t),s=[],o=Array.from(this.children).reverse();for(const h of o){const r=h.rect;if(n.x>=r.x&&n.x<=r.x+r.width&&n.y>=r.y&&n.y<=r.y+r.height){s.push(h);continue}}return s.slice(0,e)}onMouseDown(t){super.onMouseDown(t),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=t.button===1,this.updateCursor()}onMouseUp(t){super.onMouseUp(t),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=!1,this.updateCursor()}onMouseMove(t){const e=this.mouse;super.onMouseMove(t),this.hovered=this.select(this.mouse),this.mouseDown&&this.move(new DOMPoint(this.mouse.x-e.x,this.mouse.y-e.y)),this.updateCursor()}onTouchStart(t){if(super.onTouchStart(t),!this.gestureEvent&&this.canSelect){const e=t.touches[0],n=new DOMPoint(e.clientX,e.clientY);this.updateSelection(this.select(n))}}onTouchMove(t){const e=(this.touches||[])[0];if(super.onTouchMove(t),!this.gestureEvent){const n=t.touches[0];this.move(new DOMPoint(n.clientX-e.clientX,n.clientY-e.clientY))}}move(t){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(t.x,t.y));else if(this.canMove&&this.selection.length>0){const e=this.info.scale;for(const n of this.selection){const s=n.rect;s.x+=t.x/e,s.y+=t.y/e,n.rect=s,this.notify()}}}onKeyDownEvent(t){super.onKeyDownEvent(t),t.key==="Backspace"&&this.removeSelection(),this.spacePressed=t.key===" ",this.updateCursor()}onKeyUpEvent(t){super.onKeyUpEvent(t),this.spacePressed=!1,this.updateCursor()}updateCursor(){const{hovered:t,selection:e,spacePressed:n,canMove:s}=this,o=e.length>0&&e.every(h=>t.includes(h));n||this.middleClick?this.canvas.style.cursor="grab":e.length>0&&o&&s?this.canvas.style.cursor="move":this.canvas.style.cursor="default"}updateSelection(t){this.selection=t,this.notify()}clearSelection(){this.updateSelection([])}removeSelection(){!this.canDelete||(this.children=this.children.filter(t=>!this.selection.includes(t)),this.clearSelection())}addChild(t){this.children.push(t),this.updateSelection([t])}}function T(i){const t=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const e of t){const{x:n,y:s}={x:Math.random()*i.canvas.width,y:Math.random()*i.canvas.height},o=new DOMRect(n,s,100,100),h=`hsl(${Math.random()*360}, 100%, 50%)`;e==="rect"&&i.addChild({rect:o,draw:r=>{r.save(),r.fillStyle=h,r.fillRect(0,0,o.width,o.height),r.restore()}}),e==="circle"&&i.addChild({rect:o,draw:r=>{r.save(),r.beginPath(),r.arc(o.width/2,o.height/2,o.width/2,0,2*Math.PI),r.fillStyle=h,r.fill(),r.restore()}})}}var L=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,y=(i,t,e,n)=>{for(var s=n>1?void 0:n?Y(t,e):t,o=i.length-1,h;o>=0;o--)(h=i[o])&&(s=(n?h(t,e,s):h(s))||s);return n&&s&&L(t,e,s),s};let d=class extends D{render(){return P` <canvas id="canvas"></canvas> `}firstUpdated(){const i=new k(this.canvas);i.addListener(()=>{const{offset:t,scale:e}=i.info;console.debug(`offset: ${t.x}, ${t.y}; scale: ${e}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,T(i),i.clearSelection(),i.paint()}};d.styles=M`
    canvas {
      --canvas-controller-background-color: #fafafa;
      --canvas-controller-grid-color: #ccc;
      --canvas-controller-selected-color: #f00;
      --canvas-controller-hovered-color: #0f0;
      cursor: pointer;
      user-select: none;
      user-zoom: none;
      /* min-height: 100vh; */
      /* max-height: 100vh; */
      /* min-width: 100vw; */
      /* max-width: 100vw; */
      /* min-height: -webkit-fill-available; */
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-controller-background-color: #333;
        --canvas-controller-grid-color: #666;
        --canvas-controller-selected-color: #bd0303;
        --canvas-controller-hovered-color: #04a104;
      }
    }
  `;y([g("#canvas")],d.prototype,"canvas",2);d=y([O("canvas-editor")],d);
