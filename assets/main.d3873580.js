import{r as p,i as w,s as m,$ as y,n as M}from"./vendor.6869b30c.js";const g=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}};g();function a(i,e){return e.startsWith("--")?getComputedStyle(i).getPropertyValue(e):e}function D(i,e,t){const{offset:o,scale:s,backgroundColor:n,gridColor:c}=t;e.save();const r=20*s,l=Math.round(o.x)%r,d=Math.round(o.y)%r;e.fillStyle=a(i,n),e.fillRect(0,0,i.width,i.height),e.strokeStyle=a(i,c),e.lineWidth=.23*s;for(let h=l;h<i.width;h+=r)e.beginPath(),e.moveTo(h,0),e.lineTo(h,i.height),e.stroke();for(let h=d;h<i.height;h+=r)e.beginPath(),e.moveTo(0,h),e.lineTo(i.width,h),e.stroke();e.restore()}class P{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)}notifyListeners(){for(const e of this.listeners)e(this)}}const f={scale:1,offset:new DOMPoint(0,0)};class E extends P{constructor(e,t=f){super();this.canvas=e,this.options=t,this.gestureEvent=!1,this.mouse=new DOMPoint(0,0),this.mouseDown=!1,this.shouldNotify=!0,this.minScale=.1,this.maxScale=10,this.ctx=this.canvas.getContext("2d"),this.transform=this.ctx.getTransform(),this.shouldNotify=!1;const{scale:o,offset:s}=t;this.scale(o),this.pan(s),this.shouldNotify=!0,this.onWheelEvent=this.onWheelEvent.bind(this),e.addEventListener("wheel",this.onWheelEvent,{passive:!1}),this.onMouseDown=this.onMouseDown.bind(this),e.addEventListener("mousedown",this.onMouseDown,!1),this.onMouseMove=this.onMouseMove.bind(this),e.addEventListener("mousemove",this.onMouseMove,!1),this.onMouseUp=this.onMouseUp.bind(this),e.addEventListener("mouseup",this.onMouseUp,!1),this.onTouchStart=this.onTouchStart.bind(this),e.addEventListener("touchstart",this.onTouchStart,!1),this.onTouchMove=this.onTouchMove.bind(this),e.addEventListener("touchmove",this.onTouchMove,!1),this.onTouchEnd=this.onTouchEnd.bind(this),e.addEventListener("touchend",this.onTouchEnd,!1),this.onKeyDownEvent=this.onKeyDownEvent.bind(this),this.onKeyUpEvent=this.onKeyUpEvent.bind(this),document.addEventListener("keydown",this.onKeyDownEvent,!1),document.addEventListener("keyup",this.onKeyUpEvent,!1)}get matrix(){return this.transform}set matrix(e){this.transform=e,this.notify()}notify(){!this.shouldNotify||this.notifyListeners()}localPoint(e){const{scale:t,offset:o}=this.info,s=e.x/t-o.x/t,n=e.y/t-o.y/t;return new DOMPoint(s,n)}applyTransform(e){e.setTransform(this.matrix)}scale(e,t=new DOMPoint(0,0)){if(Number.isNaN(e))return;console.debug("scale",e,t);const o=e*this.info.scale;if(this.options.scale=o,o<this.minScale||o>this.maxScale)return;const s=this.localPoint(t);this.matrix=this.matrix.scale(e,e,0,s.x,s.y,s.z),this.notify()}pan(e){if(Number.isNaN(e))return;const{scale:t}=this.info;console.debug("pan",e),this.options.offset.x+=e.x/t,this.options.offset.y+=e.y/t,this.matrix=this.matrix.translate(e.x/t,e.y/t,e.z/t),this.notify()}get info(){const{scaleX:e,scaleY:t,translateX:o,translateY:s,rotate:n}=O(this.matrix);return{scale:Math.min(e,t),offset:new DOMPoint(o,s),rotation:n,mouse:this.mouse,mouseDown:this.mouseDown}}onWheelEvent(e){if(e.preventDefault(),this.gestureEvent)return;const t=new DOMPoint(e.offsetX,e.offsetY);if(e.ctrlKey){let o=1;e.deltaY<0?o=Math.min(this.maxScale,o*1.1):o=Math.max(this.minScale,o*(1/1.1)),this.scale(o,t)}else this.pan(new DOMPoint(-e.deltaX,-e.deltaY))}onMouseDown(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!0}onMouseMove(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY)}onMouseUp(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!1}onTouchStart(e){e.preventDefault(),this.touches=e.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1}onTouchMove(e){e.preventDefault();const t=this.touches;if(this.touches=e.touches,this.gestureEvent){if(this.touches.length===2){const o=new DOMPoint((t[0].clientX+t[1].clientX)/2,(t[0].clientY+t[1].clientY)/2),s=new DOMPoint((e.touches[0].clientX+e.touches[1].clientX)/2,(e.touches[0].clientY+e.touches[1].clientY)/2),n=t[0].clientX-t[1].clientX,r=(e.touches[0].clientX-e.touches[1].clientX)/n;if(this.scale(r,s),s!==o){const l=new DOMPoint(s.x-o.x,s.y-o.y);this.pan(l)}}else if(this.touches.length===3){const o=new DOMPoint(Math.min(t[0].clientX,t[1].clientX,t[2].clientX),Math.min(t[0].clientY,t[1].clientY,t[2].clientY)),s=new DOMPoint(Math.min(e.touches[0].clientX,e.touches[1].clientX,e.touches[2].clientX),Math.min(e.touches[0].clientY,e.touches[1].clientY,e.touches[2].clientY)),n=new DOMPoint(s.x-o.x,s.y-o.y);this.pan(n)}}}onTouchEnd(e){e.preventDefault(),this.touches=e.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1}onKeyDownEvent(e){e.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):e.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):e.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):e.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):e.key==="="?this.scale(1.1,this.mouse):e.key==="-"&&this.scale(1/1.1,this.mouse)}onKeyUpEvent(e){}}function O(i){const e=(i.a+i.d)/2,t=(i.a-i.d)/2,o=(i.c+i.b)/2,s=(i.c-i.b)/2,n=Math.sqrt(e*e+s*s),c=Math.sqrt(t*t+o*o),r=Math.atan2(o,t),l=Math.atan2(s,e),d=(l-r)/2,h=(l+r)/2;return{translateX:i.e,translateY:i.f,rotate:-h*180/Math.PI,scaleX:n+c,scaleY:n-c,skew:-d*180/Math.PI}}class S extends E{constructor(e,t=f){super(e,t);this.canvas=e,this.options=t,this.children=[],this.selection=[],this.hovered=[],this.canSelect=!0,this.canMove=!0,this.canDelete=!0,this.spacePressed=!1,this.middleClick=!1}drawBackground(){const{offset:e,scale:t}=this.info,{ctx:o,canvas:s}=this;o.fillStyle=a(s,"--canvas-controller-background-color"),o.fillRect(0,0,s.width,s.height),D(s,o,{offset:e,scale:t,backgroundColor:"--canvas-controller-background-color",gridColor:"--canvas-controller-grid-color"})}resize(){const e=this.canvas,t=getComputedStyle(e),{canvas:o}=this;o.width=parseInt(t.width,10),o.height=parseInt(t.height,10)}paint(){const{canvas:e,ctx:t}=this;this.resize(),t.clearRect(0,0,e.width,e.height),this.drawBackground(),this.applyTransform(t),this.drawContent(t),requestAnimationFrame(()=>this.paint())}drawContent(e){for(const t of this.children)e.save(),e.translate(t.rect.x,t.rect.y),t.draw(this.ctx),e.restore(),this.selection.includes(t)?this.drawOutline(e,t.rect,"--canvas-controller-selected-color"):this.hovered.includes(t)&&this.drawOutline(e,t.rect,"--canvas-controller-hovered-color")}drawOutline(e,t,o){const{canvas:s}=this;e.save(),e.strokeStyle=a(s,o),e.strokeRect(t.x,t.y,t.width,t.height),e.restore()}select(e,t=1){const o=this.localPoint(e),s=[],n=Array.from(this.children).reverse();for(const c of n){const r=c.rect;if(o.x>=r.x&&o.x<=r.x+r.width&&o.y>=r.y&&o.y<=r.y+r.height){s.push(c);continue}}return s.slice(0,t)}onMouseDown(e){super.onMouseDown(e),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=e.button===1,this.updateCursor()}onMouseUp(e){super.onMouseUp(e),this.canSelect&&this.updateSelection(this.select(this.mouse)),this.middleClick=!1,this.updateCursor()}onMouseMove(e){const t=this.mouse;super.onMouseMove(e),this.hovered=this.select(this.mouse),this.mouseDown&&this.move(new DOMPoint(this.mouse.x-t.x,this.mouse.y-t.y)),this.updateCursor()}onTouchStart(e){if(super.onTouchStart(e),!this.gestureEvent&&this.canSelect){const t=e.touches[0],o=new DOMPoint(t.clientX,t.clientY);this.updateSelection(this.select(o))}}onTouchMove(e){const t=(this.touches||[])[0];if(super.onTouchMove(e),!this.gestureEvent){const o=e.touches[0];this.move(new DOMPoint(o.clientX-t.clientX,o.clientY-t.clientY))}}move(e){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(e.x,e.y));else if(this.canMove&&this.selection.length>0){const t=this.info.scale;for(const o of this.selection){const s=o.rect;s.x+=e.x/t,s.y+=e.y/t,o.rect=s,this.notify()}}}onKeyDownEvent(e){super.onKeyDownEvent(e),e.key==="Backspace"&&this.removeSelection(),this.spacePressed=e.key===" ",this.updateCursor()}onKeyUpEvent(e){super.onKeyUpEvent(e),this.spacePressed=!1,this.updateCursor()}updateCursor(){const{hovered:e,selection:t,spacePressed:o,canMove:s}=this,n=t.length>0&&t.every(c=>e.includes(c));o||this.middleClick?this.canvas.style.cursor="grab":t.length>0&&n&&s?this.canvas.style.cursor="move":this.canvas.style.cursor="default"}updateSelection(e){this.selection=e,this.notify()}clearSelection(){this.updateSelection([])}removeSelection(){!this.canDelete||(this.children=this.children.filter(e=>!this.selection.includes(e)),this.clearSelection())}addChild(e){this.children.push(e),this.updateSelection([e])}}function b(i){const e=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const t of e){const{x:o,y:s}={x:Math.random()*i.canvas.width,y:Math.random()*i.canvas.height},n=new DOMRect(o,s,100,100),c=`hsl(${Math.random()*360}, 100%, 50%)`;t==="rect"&&i.addChild({rect:n,draw:r=>{r.save(),r.fillStyle=c,r.fillRect(0,0,n.width,n.height),r.restore()}}),t==="circle"&&i.addChild({rect:n,draw:r=>{r.save(),r.beginPath(),r.arc(n.width/2,n.height/2,n.width/2,0,2*Math.PI),r.fillStyle=c,r.fill(),r.restore()}})}}var C=Object.defineProperty,X=Object.getOwnPropertyDescriptor,v=(i,e,t,o)=>{for(var s=o>1?void 0:o?X(e,t):e,n=i.length-1,c;n>=0;n--)(c=i[n])&&(s=(o?c(e,t,s):c(s))||s);return o&&s&&C(e,t,s),s};let u=class extends m{render(){return y` <canvas id="canvas"></canvas> `}firstUpdated(){const i=new S(this.canvas);i.addListener(()=>{const{offset:e,scale:t}=i.info;console.debug(`offset: ${e.x}, ${e.y}; scale: ${t}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,b(i),i.clearSelection(),i.paint()}};u.styles=p`
    canvas {
      --canvas-controller-background-color: #fafafa;
      --canvas-controller-grid-color: #ccc;
      --canvas-controller-selected-color: #f00;
      --canvas-controller-hovered-color: #0f0;
      width: 100%;
      height: 100%;
      /* user-zoom: none;
      user-select: none;
      touch-action: none; */
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-controller-background-color: #333;
        --canvas-controller-grid-color: #666;
        --canvas-controller-selected-color: #bd0303;
        --canvas-controller-hovered-color: #04a104;
      }
    }
  `;v([w("#canvas")],u.prototype,"canvas",2);u=v([M("canvas-editor")],u);
