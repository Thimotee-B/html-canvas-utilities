import{r as E,i as S,s as P,$ as k,n as T}from"./vendor.6869b30c.js";const L=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=e(t);fetch(t.href,i)}};L();function w(r,n){if(n.startsWith("--")){var e=getComputedStyle(r);return e.getPropertyValue(n)}return n}function Y(r,n,e){var o=e.offset,t=e.scale,i=e.backgroundColor,s=e.gridColor;n.save();var a=20*t,h=Math.round(o.x)%a,d=Math.round(o.y)%a;n.fillStyle=w(r,i),n.fillRect(0,0,r.width,r.height),n.strokeStyle=w(r,s),n.lineWidth=.23*t;for(var u=h;u<r.width;u+=a)n.beginPath(),n.moveTo(u,0),n.lineTo(u,r.height),n.stroke();for(var l=d;l<r.height;l+=a)n.beginPath(),n.moveTo(0,l),n.lineTo(r.width,l),n.stroke();n.restore()}var X=function(){function r(){this.listeners=[]}return r.prototype.addListener=function(n){this.listeners.push(n)},r.prototype.removeListener=function(n){this.listeners=this.listeners.filter(function(e){return e!==n})},r.prototype.notifyListeners=function(){for(var n=0,e=this.listeners;n<e.length;n++){var o=e[n];o(this)}},r}(),_=globalThis&&globalThis.__extends||function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])},r(n,e)};return function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(n,e);function o(){this.constructor=n}n.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),O={scale:1,offset:new DOMPoint(0,0)},A=function(r){_(n,r);function n(e,o){e===void 0&&(e=document.createElement("canvas")),o===void 0&&(o=O);var t=r.call(this)||this;t.canvas=e,t.options=o,t.gestureEvent=!1,t.mouse=new DOMPoint(0,0),t.mouseDown=!1,t.spacePressed=!1,t.controlPressed=!1,t.shiftPressed=!1,t.middleClick=!1,t.shouldNotify=!0,t.minScale=.1,t.maxScale=10,t.ctx=t.canvas.getContext("2d"),t.transform=t.ctx.getTransform(),t.shouldNotify=!1;var i=o.scale,s=o.offset;return t.scale(i),t.pan(s),t.shouldNotify=!0,t.onWheelEvent=t.onWheelEvent.bind(t),e.addEventListener("wheel",t.onWheelEvent,{passive:!1}),t.onMouseDown=t.onMouseDown.bind(t),e.addEventListener("mousedown",t.onMouseDown,!1),t.onMouseMove=t.onMouseMove.bind(t),e.addEventListener("mousemove",t.onMouseMove,!1),t.onMouseUp=t.onMouseUp.bind(t),e.addEventListener("mouseup",t.onMouseUp,!1),t.onTouchStart=t.onTouchStart.bind(t),e.addEventListener("touchstart",t.onTouchStart,!1),t.onTouchMove=t.onTouchMove.bind(t),e.addEventListener("touchmove",t.onTouchMove,!1),t.onTouchEnd=t.onTouchEnd.bind(t),e.addEventListener("touchend",t.onTouchEnd,!1),t.onDoubleClick=t.onDoubleClick.bind(t),e.addEventListener("dblclick",t.onDoubleClick,!1),t.onClick=t.onClick.bind(t),e.addEventListener("click",t.onClick,!1),t.onKeyDownEvent=t.onKeyDownEvent.bind(t),t.onKeyUpEvent=t.onKeyUpEvent.bind(t),document.addEventListener("keydown",t.onKeyDownEvent,!1),document.addEventListener("keyup",t.onKeyUpEvent,!1),t}return Object.defineProperty(n.prototype,"matrix",{get:function(){return this.transform},set:function(e){this.transform=e,this.notify()},enumerable:!1,configurable:!0}),n.prototype.notify=function(){!this.shouldNotify||this.notifyListeners()},n.prototype.localPoint=function(e){var o=this.info,t=o.scale,i=o.offset,s=e.x/t-i.x/t,a=e.y/t-i.y/t;return new DOMPoint(s,a)},n.prototype.applyTransform=function(e){e.setTransform(this.matrix)},n.prototype.scale=function(e,o){if(o===void 0&&(o=new DOMPoint(0,0)),!Number.isNaN(e)){var t=e*this.info.scale;if(this.options.scale=t,!(t<this.minScale||t>this.maxScale)){var i=this.localPoint(o);this.matrix=this.matrix.scale(e,e,0,i.x,i.y,i.z),this.notify()}}},n.prototype.pan=function(e){if(!Number.isNaN(e)){var o=this.info.scale;this.options.offset.x+=e.x/o,this.options.offset.y+=e.y/o,this.matrix=this.matrix.translate(e.x/o,e.y/o,e.z/o),this.notify()}},Object.defineProperty(n.prototype,"info",{get:function(){var e=K(this.matrix),o=e.scaleX,t=e.scaleY,i=e.translateX,s=e.translateY,a=e.rotate;return{scale:Math.min(o,t),offset:new DOMPoint(i,s),rotation:a,mouse:this.mouse,mouseDown:this.mouseDown}},enumerable:!1,configurable:!0}),n.prototype.onWheelEvent=function(e){if(this.preventDefault(e),!this.gestureEvent){var o=new DOMPoint(e.offsetX,e.offsetY);if(e.ctrlKey||this.controlPressed){var t=1;e.deltaY<0?t=Math.min(this.maxScale,t*1.1):t=Math.max(this.minScale,t*(1/1.1)),this.scale(t,o)}else this.pan(new DOMPoint(-e.deltaX,-e.deltaY))}},n.prototype.onMouseDown=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!0},n.prototype.onMouseMove=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY)},n.prototype.onMouseUp=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!1},n.prototype.onTouchStart=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1},n.prototype.onTouchMove=function(e){this.preventDefault(e);var o=this.touches;if(this.touches=e.touches,this.gestureEvent){var t=new DOMPoint(o[0].clientX,o[0].clientY),i=new DOMPoint(o[1].clientX,o[1].clientY),s=new DOMPoint(this.touches[0].clientX,this.touches[0].clientY),a=new DOMPoint(this.touches[1].clientX,this.touches[1].clientY);if(this.touches.length===2){var h=new DOMPoint((t.x+i.x)/2,(t.y+i.y)/2),d=new DOMPoint((s.x+a.x)/2,(s.y+a.y)/2),u=D(t,i),l=D(s,a),y=l/u;if(this.scale(y,d),d!==h){var f=new DOMPoint(Math.min(t.x,i.x),Math.min(t.y,i.y)),c=new DOMPoint(Math.min(s.x,a.x),Math.min(s.y,a.y)),v=new DOMPoint(c.x-f.x,c.y-f.y);this.pan(v)}}else if(this.touches.length===3){var p=new DOMPoint(o[2].clientX,o[2].clientY),b=new DOMPoint(this.touches[2].clientX,this.touches[2].clientY),f=new DOMPoint(Math.min(t.x,i.x,p.x),Math.min(t.y,i.y,p.y)),c=new DOMPoint(Math.min(s.x,a.x,p.x),Math.min(s.y,a.y,b.y)),v=new DOMPoint(c.x-f.x,c.y-f.y);this.pan(v)}}},n.prototype.onTouchEnd=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1},n.prototype.onKeyDownEvent=function(e){this.preventDefault(e),e.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):e.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):e.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):e.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):e.key==="="?this.scale(1.1,this.mouse):e.key==="-"&&this.scale(1/1.1,this.mouse),this.controlPressed=e.ctrlKey,this.shiftPressed=e.shiftKey,this.spacePressed=e.key===" "},n.prototype.onKeyUpEvent=function(e){this.preventDefault(e),this.controlPressed=!1,this.spacePressed=!1,this.shiftPressed=!1},n.prototype.onDoubleClick=function(e){this.preventDefault(e)},n.prototype.onClick=function(e){this.preventDefault(e)},n.prototype.preventDefault=function(e){e.preventDefault()},n}(X);function K(r){var n=(r.a+r.d)/2,e=(r.a-r.d)/2,o=(r.c+r.b)/2,t=(r.c-r.b)/2,i=Math.sqrt(n*n+t*t),s=Math.sqrt(e*e+o*o),a=Math.atan2(o,e),h=Math.atan2(t,n),d=(h-a)/2,u=(h+a)/2;return{translateX:r.e,translateY:r.f,rotate:-u*180/Math.PI,scaleX:i+s,scaleY:i-s,skew:-d*180/Math.PI}}function D(r,n){return Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))}var U=globalThis&&globalThis.__extends||function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=t[i])},r(n,e)};return function(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(n,e);function o(){this.constructor=n}n.prototype=e===null?Object.create(e):(o.prototype=e.prototype,new o)}}(),I=function(r){U(n,r);function n(e,o){e===void 0&&(e=document.createElement("canvas")),o===void 0&&(o=O);var t=r.call(this,e,o)||this;return t.canvas=e,t.options=o,t.children=[],t.selection=[],t.hovered=[],t.canSelect=!0,t.canMove=!0,t.canDelete=!0,t.drawGrid=!0,t.selectIndex=0,t.isMoving=!1,t}return n.prototype.drawBackground=function(){var e=this.info,o=e.offset,t=e.scale,i=this,s=i.ctx,a=i.canvas;if(this.options.drawBackground!==void 0){s.save(),this.options.drawBackground(s,o,t),s.restore();return}s.save(),s.fillStyle=w(a,"--canvas-controller-background-color"),s.fillRect(0,0,a.width,a.height),this.drawGrid&&Y(a,s,{offset:o,scale:t,backgroundColor:"--canvas-controller-background-color",gridColor:"--canvas-controller-grid-color"}),s.restore()},n.prototype.resize=function(){var e=this.canvas,o=getComputedStyle(e),t=this.canvas;t.width=parseInt(o.width,10),t.height=parseInt(o.height,10)},n.prototype.paint=function(){var e=this,o=this,t=o.canvas,i=o.ctx;this.resize(),i.clearRect(0,0,t.width,t.height),this.drawBackground(),this.applyTransform(i),this.drawContent(i),requestAnimationFrame(function(){return e.paint()})},n.prototype.drawContent=function(e){for(var o=0,t=this.children;o<t.length;o++){var i=t[o];this.drawChild(e,i)}},n.prototype.drawChild=function(e,o,t){e.save();var i=o.rect;if(e.translate(i.x,i.y),o.draw(this.ctx,{width:i.width,height:i.height}),e.restore(),o.children){e.save(),e.translate(i.x,i.y);for(var s=o.children,a=0,h=s;a<h.length;a++){var d=h[a],u=g(d.rect,t);this.drawChild(e,d,u)}e.restore()}var l=x(M(o));this.selection.includes(o)?this.drawOutline(e,l,"--canvas-controller-selected-color"):this.hovered.includes(o)&&this.drawOutline(e,l,"--canvas-controller-hovered-color")},n.prototype.drawOutline=function(e,o,t){var i=this.canvas;if(this.options.drawOutline!==void 0){e.save(),this.options.drawOutline(e,o,t),e.restore();return}e.save(),e.strokeStyle=w(i,t),e.strokeRect(o.x,o.y,o.width,o.height),e.restore()},n.prototype.getSelectionAt=function(e,o){var t=this.localPoint(e),i=[],s=function(a,h,d){h===void 0&&(h=0);for(var u=Array.from(a).reverse(),l=0,y=u;l<y.length;l++){var f=y[l],c=g(f.rect,d),v=x(M(f));if(t.x>=v.x&&t.x<=v.x+v.width&&t.y>=v.y&&t.y<=v.y+v.height){if(h===o.level){i.push(f);continue}}else if(t.x>=c.x&&t.x<=c.x+c.width&&t.y>=c.y&&t.y<=c.y+c.height&&h===o.level){i.push(f);continue}if(f.children){var p=f.children;s(p,h+1,c)}}};return s(this.children),i.slice(0,o.max)},n.prototype.onMouseDown=function(e){r.prototype.onMouseDown.call(this,e),this.canSelect&&this.updateSelection(this.getSelectionAt(this.mouse,{max:1,level:this.selectIndex})),this.middleClick=e.button===1,this.updateCursor()},n.prototype.onMouseUp=function(e){var o=this;if(r.prototype.onMouseUp.call(this,e),this.canSelect&&!this.isMoving)if(this.dblClickTimeout!==void 0){clearTimeout(this.dblClickTimeout),this.dblClickTimeout=void 0,this.selectIndex+=1;var t=new DOMPoint(e.clientX,e.clientY);this.mouse=t,this.selectAt(t)}else this.dblClickTimeout=window.setTimeout(function(){o.dblClickTimeout=void 0,o.selectIndex=0;var i=new DOMPoint(e.clientX,e.clientY);o.mouse=i,o.selectAt(i)},300);this.isMoving=!1,this.middleClick=!1,this.updateCursor()},n.prototype.onMouseMove=function(e){var o=this.mouse;r.prototype.onMouseMove.call(this,e),this.hovered=this.getSelectionAt(this.mouse,{max:1,level:0}),this.mouseDown&&(this.isMoving=!0,this.move(new DOMPoint(this.mouse.x-o.x,this.mouse.y-o.y))),this.updateCursor()},n.prototype.onTouchStart=function(e){if(r.prototype.onTouchStart.call(this,e),!this.gestureEvent&&this.canSelect){var o=e.touches[0],t=new DOMPoint(o.clientX,o.clientY);this.selectIndex=0,this.selectAt(t)}},n.prototype.onTouchMove=function(e){var o=(this.touches||[])[0];if(r.prototype.onTouchMove.call(this,e),!this.gestureEvent){var t=e.touches[0];this.move(new DOMPoint(t.clientX-o.clientX,t.clientY-o.clientY))}},n.prototype.move=function(e){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(e.x,e.y));else if(this.canMove&&this.selection.length>0)for(var o=this.info.scale,t=0,i=this.selection;t<i.length;t++){var s=i[t],a=s.rect;a.x+=e.x/o,a.y+=e.y/o,s.rect=a,this.notify()}},n.prototype.onKeyDownEvent=function(e){r.prototype.onKeyDownEvent.call(this,e),e.key==="Backspace"&&this.removeSelection(),this.updateCursor()},n.prototype.onKeyUpEvent=function(e){r.prototype.onKeyUpEvent.call(this,e),this.updateCursor()},n.prototype.updateCursor=function(){var e=this,o=e.hovered,t=e.selection,i=e.spacePressed,s=e.canMove,a=t.length>0&&t.every(function(h){return o.includes(h)});i||this.middleClick?this.canvas.style.cursor="grab":t.length>0&&a&&s?this.canvas.style.cursor="move":this.canvas.style.cursor="default"},n.prototype.selectAt=function(e){var o=this.getSelectionAt(e,{max:1,level:this.selectIndex});this.updateSelection(o)},n.prototype.updateSelection=function(e){this.selection=e,this.notify()},n.prototype.clearSelection=function(){this.updateSelection([])},n.prototype.removeSelection=function(){var e=this;!this.canDelete||(this.children=this.children.filter(function(o){return!e.selection.includes(o)}),this.clearSelection())},n.prototype.addChild=function(e){this.children.push(e),this.updateSelection([e])},n}(A);function g(r,n){return n?new DOMRect(n.x+r.x,n.y+r.y,r.width,r.height):r}function M(r,n){var e=[],o=g(r.rect,n);if(e.push(o),r.children)for(var t=r.children,i=0,s=t;i<s.length;i++){var a=s[i];e.push.apply(e,M(a,o))}return e}function x(r){if(r.length===0)return new DOMRect(0,0,0,0);var n=new DOMRect(r[0].x,r[0].y,r[0].width,r[0].height);return r.reduce(function(e,o){return o.x<e.x&&(e.width+=e.x-o.x,e.x=o.x),o.y<e.y&&(e.height+=e.y-o.y,e.y=o.y),o.x+o.width>e.x+e.width&&(e.width=o.x+o.width-e.x),o.y+o.height>e.y+e.height&&(e.height=o.y+o.height-e.y),e},n)}function N(r){const n=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const e of n){const{x:o,y:t}={x:Math.random()*r.canvas.width,y:Math.random()*r.canvas.height},i=new DOMRect(o,t,100,100),s=`hsl(${Math.random()*360}, 100%, 50%)`;e==="rect"&&r.addChild({rect:i,draw:a=>{a.save(),a.fillStyle=s,a.fillRect(0,0,i.width,i.height),a.restore()}}),e==="circle"&&r.addChild({rect:i,draw:a=>{a.save(),a.beginPath(),a.arc(i.width/2,i.height/2,i.width/2,0,2*Math.PI),a.fillStyle=s,a.fill(),a.restore()}})}}var j=Object.defineProperty,R=Object.getOwnPropertyDescriptor,C=(r,n,e,o)=>{for(var t=o>1?void 0:o?R(n,e):n,i=r.length-1,s;i>=0;i--)(s=r[i])&&(t=(o?s(n,e,t):s(t))||t);return o&&t&&j(n,e,t),t};let m=class extends P{render(){return k` <canvas id="canvas"></canvas> `}firstUpdated(){const r=new I(this.canvas);r.addListener(()=>{const{offset:n,scale:e}=r.info;console.debug(`offset: ${n.x}, ${n.y}; scale: ${e}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,N(r),r.clearSelection(),r.paint()}};m.styles=E`
    canvas {
      --canvas-controller-background-color: #fafafa;
      --canvas-controller-grid-color: #ccc;
      --canvas-controller-selected-color: #f00;
      --canvas-controller-hovered-color: #0f0;
      cursor: pointer;
      user-select: none;
      user-zoom: none;
      /* min-height: 100vh; */
      /* max-height: 100vh; */
      /* min-width: 100vw; */
      /* max-width: 100vw; */
      /* min-height: -webkit-fill-available; */
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-controller-background-color: #333;
        --canvas-controller-grid-color: #666;
        --canvas-controller-selected-color: #bd0303;
        --canvas-controller-hovered-color: #04a104;
      }
    }
  `;C([S("#canvas")],m.prototype,"canvas",2);m=C([T("canvas-editor")],m);
