import{r as b,i as S,s as E,$ as k,n as T}from"./vendor.6869b30c.js";const L=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=e(t);fetch(t.href,i)}};L();function w(s,o){if(o.startsWith("--")){var e=getComputedStyle(s);return e.getPropertyValue(o)}return o}function Y(s,o,e){var n=e.offset,t=e.scale,i=e.backgroundColor,r=e.gridColor;o.save();var a=20*t,h=Math.round(n.x)%a,u=Math.round(n.y)%a;o.fillStyle=w(s,i),o.fillRect(0,0,s.width,s.height),o.strokeStyle=w(s,r),o.lineWidth=.23*t;for(var c=h;c<s.width;c+=a)o.beginPath(),o.moveTo(c,0),o.lineTo(c,s.height),o.stroke();for(var d=u;d<s.height;d+=a)o.beginPath(),o.moveTo(0,d),o.lineTo(s.width,d),o.stroke();o.restore()}var X=function(){function s(){this.listeners=[]}return s.prototype.addListener=function(o){this.listeners.push(o)},s.prototype.removeListener=function(o){this.listeners=this.listeners.filter(function(e){return e!==o})},s.prototype.notifyListeners=function(){for(var o=0,e=this.listeners;o<e.length;o++){var n=e[o];n(this)}},s}(),_=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function n(){this.constructor=o}o.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),x={scale:1,offset:new DOMPoint(0,0)},K=function(s){_(o,s);function o(e,n){e===void 0&&(e=document.createElement("canvas")),n===void 0&&(n=x);var t=s.call(this)||this;t.canvas=e,t.options=n,t.gestureEvent=!1,t.mouse=new DOMPoint(0,0),t.mouseDown=!1,t.spacePressed=!1,t.controlPressed=!1,t.shiftPressed=!1,t.metaPressed=!1,t.middleClick=!1,t.shouldNotify=!0,t.minScale=.1,t.maxScale=10,t.ctx=t.canvas.getContext("2d"),t.transform=t.ctx.getTransform(),t.shouldNotify=!1;var i=n.scale,r=n.offset;return t.scale(i),t.pan(r),t.shouldNotify=!0,t.onWheelEvent=t.onWheelEvent.bind(t),e.addEventListener("wheel",t.onWheelEvent,{passive:!1}),t.onMouseDown=t.onMouseDown.bind(t),e.addEventListener("mousedown",t.onMouseDown,!1),t.onMouseMove=t.onMouseMove.bind(t),e.addEventListener("mousemove",t.onMouseMove,!1),t.onMouseUp=t.onMouseUp.bind(t),e.addEventListener("mouseup",t.onMouseUp,!1),t.onTouchStart=t.onTouchStart.bind(t),e.addEventListener("touchstart",t.onTouchStart,!1),t.onTouchMove=t.onTouchMove.bind(t),e.addEventListener("touchmove",t.onTouchMove,!1),t.onTouchEnd=t.onTouchEnd.bind(t),e.addEventListener("touchend",t.onTouchEnd,!1),t.onDoubleClick=t.onDoubleClick.bind(t),e.addEventListener("dblclick",t.onDoubleClick,!1),t.onClick=t.onClick.bind(t),e.addEventListener("click",t.onClick,!1),t.onKeyDownEvent=t.onKeyDownEvent.bind(t),t.onKeyUpEvent=t.onKeyUpEvent.bind(t),document.addEventListener("keydown",t.onKeyDownEvent,!1),document.addEventListener("keyup",t.onKeyUpEvent,!1),t}return Object.defineProperty(o.prototype,"matrix",{get:function(){return this.transform},set:function(e){this.transform=e,this.notify()},enumerable:!1,configurable:!0}),o.prototype.notify=function(){!this.shouldNotify||this.notifyListeners()},o.prototype.localPoint=function(e){var n=this.info,t=n.scale,i=n.offset,r=e.x/t-i.x/t,a=e.y/t-i.y/t;return new DOMPoint(r,a)},o.prototype.applyTransform=function(e){e.setTransform(this.matrix)},o.prototype.scale=function(e,n){if(n===void 0&&(n=new DOMPoint(0,0)),!Number.isNaN(e)){var t=e*this.info.scale;if(this.options.scale=t,!(t<this.minScale||t>this.maxScale)){var i=this.localPoint(n);this.matrix=this.matrix.scale(e,e,0,i.x,i.y,i.z),this.notify()}}},o.prototype.pan=function(e){if(!Number.isNaN(e)){var n=this.info.scale;this.options.offset.x+=e.x/n,this.options.offset.y+=e.y/n,this.matrix=this.matrix.translate(e.x/n,e.y/n,e.z/n),this.notify()}},Object.defineProperty(o.prototype,"info",{get:function(){var e=A(this.matrix),n=e.scaleX,t=e.scaleY,i=e.translateX,r=e.translateY,a=e.rotate;return{scale:Math.min(n,t),offset:new DOMPoint(i,r),rotation:a,mouse:this.mouse,mouseDown:this.mouseDown}},enumerable:!1,configurable:!0}),o.prototype.onWheelEvent=function(e){if(this.preventDefault(e),!this.gestureEvent){var n=new DOMPoint(e.offsetX,e.offsetY);if(e.ctrlKey||this.controlPressed){var t=1;e.deltaY<0?t=Math.min(this.maxScale,t*1.1):t=Math.max(this.minScale,t*(1/1.1)),this.scale(t,n)}else this.pan(new DOMPoint(-e.deltaX,-e.deltaY))}},o.prototype.onMouseDown=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!0},o.prototype.onMouseMove=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY)},o.prototype.onMouseUp=function(e){this.mouse=new DOMPoint(e.offsetX,e.offsetY),this.mouseDown=!1},o.prototype.onTouchStart=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=!0,this.gestureEvent=this.touches.length>1},o.prototype.onTouchMove=function(e){this.preventDefault(e);var n=this.touches;if(this.touches=e.touches,this.gestureEvent){var t=new DOMPoint(n[0].clientX,n[0].clientY),i=new DOMPoint(n[1].clientX,n[1].clientY),r=new DOMPoint(this.touches[0].clientX,this.touches[0].clientY),a=new DOMPoint(this.touches[1].clientX,this.touches[1].clientY);if(this.touches.length===2){var h=new DOMPoint((t.x+i.x)/2,(t.y+i.y)/2),u=new DOMPoint((r.x+a.x)/2,(r.y+a.y)/2),c=D(t,i),d=D(r,a),y=d/c;if(this.scale(y,u),u!==h){var f=new DOMPoint(Math.min(t.x,i.x),Math.min(t.y,i.y)),l=new DOMPoint(Math.min(r.x,a.x),Math.min(r.y,a.y)),v=new DOMPoint(l.x-f.x,l.y-f.y);this.pan(v)}}else if(this.touches.length===3){var p=new DOMPoint(n[2].clientX,n[2].clientY),P=new DOMPoint(this.touches[2].clientX,this.touches[2].clientY),f=new DOMPoint(Math.min(t.x,i.x,p.x),Math.min(t.y,i.y,p.y)),l=new DOMPoint(Math.min(r.x,a.x,p.x),Math.min(r.y,a.y,P.y)),v=new DOMPoint(l.x-f.x,l.y-f.y);this.pan(v)}}},o.prototype.onTouchEnd=function(e){this.preventDefault(e),this.touches=e.touches,this.mouseDown=this.touches.length===0,this.gestureEvent=this.touches.length>1},o.prototype.onKeyDownEvent=function(e){this.preventDefault(e),e.key==="ArrowLeft"?this.pan(new DOMPoint(-10,0)):e.key==="ArrowRight"?this.pan(new DOMPoint(10,0)):e.key==="ArrowUp"?this.pan(new DOMPoint(0,-10)):e.key==="ArrowDown"?this.pan(new DOMPoint(0,10)):e.key==="="?this.scale(1.1,this.mouse):e.key==="-"&&this.scale(1/1.1,this.mouse),this.controlPressed=e.ctrlKey,this.shiftPressed=e.shiftKey,this.metaPressed=e.metaKey,this.spacePressed=e.key===" "},o.prototype.onKeyUpEvent=function(e){this.preventDefault(e),this.controlPressed=!1,this.spacePressed=!1,this.shiftPressed=!1,this.metaPressed=!1},o.prototype.onDoubleClick=function(e){this.preventDefault(e)},o.prototype.onClick=function(e){this.preventDefault(e)},o.prototype.preventDefault=function(e){e.preventDefault()},o}(X);function A(s){var o=(s.a+s.d)/2,e=(s.a-s.d)/2,n=(s.c+s.b)/2,t=(s.c-s.b)/2,i=Math.sqrt(o*o+t*t),r=Math.sqrt(e*e+n*n),a=Math.atan2(n,e),h=Math.atan2(t,o),u=(h-a)/2,c=(h+a)/2;return{translateX:s.e,translateY:s.f,rotate:-c*180/Math.PI,scaleX:i+r,scaleY:i-r,skew:-u*180/Math.PI}}function D(s,o){return Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))}var U=globalThis&&globalThis.__extends||function(){var s=function(o,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},s(o,e)};return function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(o,e);function n(){this.constructor=o}o.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),I=function(s){U(o,s);function o(e,n){e===void 0&&(e=document.createElement("canvas")),n===void 0&&(n=x);var t=s.call(this,e,n)||this;return t.canvas=e,t.options=n,t.children=[],t.selection=[],t.hovered=[],t.canSelect=!0,t.canMove=!0,t.canDelete=!0,t.drawGrid=!0,t.selectIndex=0,t.isMoving=!1,t}return o.prototype.drawBackground=function(){var e=this.info,n=e.offset,t=e.scale,i=this,r=i.ctx,a=i.canvas;if(this.options.drawBackground!==void 0){r.save(),this.options.drawBackground(r,n,t),r.restore();return}r.save(),r.fillStyle=w(a,"--canvas-background-color"),r.fillRect(0,0,a.width,a.height),this.drawGrid&&Y(a,r,{offset:n,scale:t,backgroundColor:"--canvas-background-color",gridColor:"--canvas-grid-color"}),r.restore()},o.prototype.resize=function(){var e=this.canvas,n=getComputedStyle(e),t=this.canvas;t.width=parseInt(n.width,10),t.height=parseInt(n.height,10)},o.prototype.paint=function(){var e=this,n=this,t=n.canvas,i=n.ctx;if(this.resize(),i.clearRect(0,0,t.width,t.height),this.drawBackground(),this.applyTransform(i),this.drawContent(i),this.selection.length>1){var r=g(this.selection.map(function(a){return a.rect}));this.drawOutline(i,r,"--canvas-selected-color")}requestAnimationFrame(function(){return e.paint()})},o.prototype.drawContent=function(e){for(var n=0,t=this.children;n<t.length;n++){var i=t[n];this.drawChild(e,i)}},o.prototype.drawChild=function(e,n,t){e.save();var i=n.rect;if(e.translate(i.x,i.y),n.draw(this.ctx,{width:i.width,height:i.height}),e.restore(),n.children){e.save(),e.translate(i.x,i.y);for(var r=n.children,a=0,h=r;a<h.length;a++){var u=h[a],c=M(u.rect,t);this.drawChild(e,u,c)}e.restore()}this.selection.length===1&&this.selection[0]===n?this.drawOutline(e,i,"--canvas-selected-color"):this.hovered.length===1&&this.hovered[0]===n&&this.drawOutline(e,i,"--canvas-hovered-color")},o.prototype.drawOutline=function(e,n,t){var i=this.canvas;if(this.options.drawOutline!==void 0){e.save(),this.options.drawOutline(e,n,t),e.restore();return}e.save(),e.strokeStyle=w(i,t),e.strokeRect(n.x,n.y,n.width,n.height),e.restore()},o.prototype.getSelectionAt=function(e,n){var t=this.localPoint(e),i=[],r=function(a,h,u){h===void 0&&(h=0);for(var c=Array.from(a).reverse(),d=0,y=c;d<y.length;d++){var f=y[d],l=M(f.rect,u),v=g(O(f));if(t.x>=v.x&&t.x<=v.x+v.width&&t.y>=v.y&&t.y<=v.y+v.height){if(h===n.level){i.push(f);continue}}else if(t.x>=l.x&&t.x<=l.x+l.width&&t.y>=l.y&&t.y<=l.y+l.height&&h===n.level){i.push(f);continue}if(f.children){var p=f.children;r(p,h+1,l)}}};return r(this.children),i.slice(0,n.max)},o.prototype.onMouseDown=function(e){if(s.prototype.onMouseDown.call(this,e),this.middleClick=e.button===1,this.canSelect){if(this.selection.length>0){var n=this.localPoint(this.mouse),t=g(this.selection.map(function(r){return r.rect}));if(n.x>=t.x&&n.x<=t.x+t.width&&n.y>=t.y&&n.y<=t.y+t.height)return}var i=this.getSelectionAt(this.mouse,{max:1,level:this.selectIndex});this.updateSelection(i)}this.updateCursor()},o.prototype.onMouseUp=function(e){var n=this;if(s.prototype.onMouseUp.call(this,e),this.canSelect&&!this.isMoving)if(this.dblClickTimeout!==void 0){clearTimeout(this.dblClickTimeout),this.dblClickTimeout=void 0,this.selectIndex+=1;var t=new DOMPoint(e.clientX,e.clientY);this.mouse=t,this.selectAt(t)}else this.dblClickTimeout=window.setTimeout(function(){n.dblClickTimeout=void 0,n.selectIndex=0;var i=new DOMPoint(e.clientX,e.clientY);n.mouse=i,n.selectAt(i)},200);this.isMoving=!1,this.middleClick=!1,this.updateCursor()},o.prototype.onMouseMove=function(e){var n=this.mouse;s.prototype.onMouseMove.call(this,e),this.hovered=this.getSelectionAt(this.mouse,{max:1,level:0}),this.mouseDown&&(this.isMoving=!0,this.move(new DOMPoint(this.mouse.x-n.x,this.mouse.y-n.y))),this.updateCursor()},o.prototype.onTouchStart=function(e){if(s.prototype.onTouchStart.call(this,e),!this.gestureEvent&&this.canSelect){var n=e.touches[0],t=new DOMPoint(n.clientX,n.clientY);this.selectIndex=0,this.selectAt(t)}},o.prototype.onTouchMove=function(e){var n=(this.touches||[])[0];if(s.prototype.onTouchMove.call(this,e),!this.gestureEvent){var t=e.touches[0];this.info.scale;var i=new DOMPoint(t.clientX-n.clientX,t.clientY-n.clientY);this.move(i)}},o.prototype.move=function(e){if(this.spacePressed||this.middleClick)this.pan(new DOMPoint(e.x,e.y));else if(this.canMove&&this.selection.length>0){for(var n=this.info.scale,t=0,i=this.selection;t<i.length;t++){var r=i[t];r.rect.x+=e.x/n,r.rect.y+=e.y/n}this.notify()}},o.prototype.onKeyDownEvent=function(e){s.prototype.onKeyDownEvent.call(this,e),e.key==="Backspace"&&this.removeSelection(),e.metaKey&&e.key==="a"&&this.updateSelection(this.children),this.updateCursor()},o.prototype.onKeyUpEvent=function(e){s.prototype.onKeyUpEvent.call(this,e),this.updateCursor()},o.prototype.updateCursor=function(){var e=this,n=e.hovered,t=e.selection,i=e.spacePressed,r=e.canMove,a=t.length>0&&t.every(function(h){return n.includes(h)});i||this.middleClick?this.canvas.style.cursor="grab":t.length>0&&a&&r?this.canvas.style.cursor="move":this.canvas.style.cursor="default"},o.prototype.selectAt=function(e){var n=this.getSelectionAt(e,{max:1,level:this.selectIndex});this.updateSelection(n)},o.prototype.updateSelection=function(e){var n=this;this.shiftPressed?(this.selection=this.selection.concat(e),this.selection=this.selection.filter(function(t,i){return n.selection.indexOf(t)===i})):this.selection=e,this.updateCursor(),this.notify()},o.prototype.clearSelection=function(){this.updateSelection([])},o.prototype.removeSelection=function(){var e=this;!this.canDelete||(this.children=this.children.filter(function(n){return!e.selection.includes(n)}),this.clearSelection())},o.prototype.addChild=function(e){this.children.push(e),this.updateSelection([e])},o}(K);function M(s,o){return o?new DOMRect(o.x+s.x,o.y+s.y,s.width,s.height):s}function O(s,o){var e=[],n=M(s.rect,o);if(e.push(n),s.children)for(var t=s.children,i=0,r=t;i<r.length;i++){var a=r[i];e.push.apply(e,O(a,n))}return e}function g(s){if(s.length===0)return new DOMRect(0,0,0,0);var o=new DOMRect(s[0].x,s[0].y,s[0].width,s[0].height);return s.reduce(function(e,n){return n.x<e.x&&(e.width+=e.x-n.x,e.x=n.x),n.y<e.y&&(e.height+=e.y-n.y,e.y=n.y),n.x+n.width>e.x+e.width&&(e.width=n.x+n.width-e.x),n.y+n.height>e.y+e.height&&(e.height=n.y+n.height-e.y),e},o)}function N(s){const o=["circle","rect","circle","rect","circle","rect","circle","rect","circle","rect"];for(const e of o){const{x:n,y:t}={x:Math.random()*s.canvas.width,y:Math.random()*s.canvas.height},i=new DOMRect(n,t,100,100),r=`hsl(${Math.random()*360}, 100%, 50%)`;e==="rect"&&s.addChild({rect:i,draw:a=>{a.save(),a.fillStyle=r,a.fillRect(0,0,i.width,i.height),a.restore()}}),e==="circle"&&s.addChild({rect:i,draw:a=>{a.save(),a.beginPath(),a.arc(i.width/2,i.height/2,i.width/2,0,2*Math.PI),a.fillStyle=r,a.fill(),a.restore()}})}}var j=Object.defineProperty,R=Object.getOwnPropertyDescriptor,C=(s,o,e,n)=>{for(var t=n>1?void 0:n?R(o,e):o,i=s.length-1,r;i>=0;i--)(r=s[i])&&(t=(n?r(o,e,t):r(t))||t);return n&&t&&j(o,e,t),t};let m=class extends E{render(){return k` <canvas id="canvas"></canvas> `}firstUpdated(){const s=new I(this.canvas);s.addListener(()=>{const{offset:o,scale:e}=s.info;console.debug(`offset: ${o.x}, ${o.y}; scale: ${e}`)}),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,N(s),s.clearSelection(),s.paint()}};m.styles=b`
    canvas {
      --canvas-background-color: #fafafa;
      --canvas-grid-color: #ccc;
      --canvas-selected-color: #f00;
      --canvas-hovered-color: #0f0;
      cursor: pointer;
      user-select: none;
      user-zoom: none;
      /* min-height: 100vh; */
      /* max-height: 100vh; */
      /* min-width: 100vw; */
      /* max-width: 100vw; */
      /* min-height: -webkit-fill-available; */
    }
    @media (prefers-color-scheme: dark) {
      canvas {
        --canvas-background-color: #333;
        --canvas-grid-color: #666;
        --canvas-selected-color: #bd0303;
        --canvas-hovered-color: #04a104;
      }
    }
  `;C([S("#canvas")],m.prototype,"canvas",2);m=C([T("canvas-editor")],m);
